# lcd-client

## 项目介绍
* 本项目是理财登记中心(简称理财登) 文件交互客户端,基于理财登提供的 sdk,通过专网实现通过理财登记中心服务端(简称中登)与其他理财机构进行文件交互.
* 需要和中登服务器直接连接通信,交互协议为 https ,同时会本地启动 http 服务监听中登才送过来的请求,如果多机部署需要配置前置负载均衡

## 功能介绍
* 无外部第三方中间件依赖,比如数据库,zk
* 可以把对应配置文件放到 jar 同目录,新增机构无需重新打包部署,修改后自动重新加载配置,默认 5 分钟,也可以手动触发刷新.
* 有一些备用接口,生产环境如果出现问题可以重试调整
* 用 与源文件同名的 ok 空文件用来标识文件的传输完成标志

## 启动部署
* 配置专线或者连接到测试路由器;配置理财登客户端参数
* 配置 hosts, 添加 ```33.24.0.24 api-wm.chinawealth.com.cn``` 或者路由器配置静态dns
* 把一些证书和秘钥文件放到resources目录
* 修改 对应环境的 yaml 配置, 包括文件存储目录(path.common.base)和证书存储目录(path.zd.cert),机构参数(organization.*,sdkconfig. *)
* 保证 logback.xml 下日志文件路径存在
* 启动 ```java  -Dspring.profiles.active=dev,zd  -jar lcd.jar``` ,dev 为哪个环境,zd,为启动功能选择



## 本地文件目录介绍
```

├── share                    //文件交互根目录  
│   ├── receive              //从中登接收的文件,按照日期分组,所有ta的文件在一起
│   │   ├── 20220112
│   ├── receive_bak          // 从中登接收的文件(receive)发送到 ftp 或者其他地方后悔移动到这里
│   │   └── 20220210
│   ├── send                 //需要发送到中登的文件,按照日期分组,所有ta的文件在一起,文件可能是百信 ftp 拉取过来的
│   │   ├── 20220112
│   └── send_bak             //需要发送到中登的文件(send) 发送成功后会移动到这里
│       ├── 20220113
└── tmp                      // 与中登交互文件临时目录,如果share 目录没有文件,可以在这里找原始文件
    │   ├── decryptFilePath  //收到的文件解密后存储目录
    │   └── encrypFilePath   //发送的文件加密后存储目录
```

## 业务功能
* 本地文件与理财登服务器文件收发

start 启动脚本  示例 ./start uat
stop  停止脚本 ./stop
